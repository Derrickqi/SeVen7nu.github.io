---
layout:     post   				    # 使用的布局（不需要改）
title:      kubernetes资源的使用 	# 标题 
subtitle:   				 		#副标题
date:       2022-06-06 				# 时间
author:     Derrick 				# 作者
header-img: img/post-bg-k8sOperate.jpg 	#这篇文章标题背景图片
catalog: true 						# 是否归档
tags:								#标签
    - Kubernetes
---




### ConfigMap/Secret配置管理



**定义ConfigMap**
```
apiVersion: v1
kind: ConfigMap
metadata:
  name: game-demo
data:
    lives: "3"
    secret.code: "true"
    test_env: derrickqi
```

-------------------------



#### 使用valueFrom定义环境变量


**定义Deployment**
```
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: nginx
  name: nginx
spec:
  replicas: 1
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - image: registry.cn-hangzhou.aliyuncs.com/derrickqi/mysql:5.7
        name: nginx
        env:
        - name: TEST_ENV
          value: testenv
        - name: LIVES
          valueFrom:
            configMapKeyRef:
                name: game-demo     #与ConfigMap名称相同
                key: lives
        - name: test_env
          valueFrom:
            configMapKeyRef:
                name: game-demo
                key:  test_env
```
<br/><br/><br/>
#### 使用envFrom定义环境变量


**定义Deployment**
```
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: nginx-cmp
  name: nginx-cmp
spec:
  replicas: 1
  selector:
    matchLabels:
      app: nginx-cmp
  template:
    metadata:
      labels:
        app: nginx-cmp
    spec:
      containers:
      - image: registry.cn-hangzhou.aliyuncs.com/derrickqi/nginx:1.20.2
        name: nginx
        envFrom:        #将ConfigMap里的环境变量全部引入
        - configMapRef:
            name: game-demo


```
<br/><br/><br/>
#### 以文件的形式挂载ConfigMap

**定义ConfigMap和Secret**
```
apiVersion: v1
data:
  nginx.conf: |2

    user  nginx;
    worker_processes  auto;

    error_log  /var/log/nginx/error.log notice;
    pid        /var/run/nginx.pid;


    events {
        worker_connections  1024;
    }


    http {
        include       /etc/nginx/mime.types;
        default_type  application/octet-stream;

        log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
                          '$status $body_bytes_sent "$http_referer" '
                          '"$http_user_agent" "$http_x_forwarded_for"';

        access_log  /var/log/nginx/access.log  main;

        sendfile        on;
        #tcp_nopush     on;

        keepalive_timeout  65;

        #gzip  on;

        include /etc/nginx/conf.d/*.conf;
    }
kind: ConfigMap
metadata:
  name: nginx-conf
  namespace: test-project

```
-------------------------





**创建Deployment**
```
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: web
  name: nginx
  namespace: test-project
spec:
  replicas: 1
  selector:
    matchLabels:
      app: web
  template:
    metadata:
      labels:
        app: web
    spec:
      containers:
      - image: registry.cn-hangzhou.aliyuncs.com/derrickqi/nginx:1.20.2
        name: nginx
        volumeMounts:
         - name: nginx-conf
           mountPath: "/etc/nginx/nginx.conf"
           subPath: nginx.conf
           readOnly: true
      volumes:
        - name: nginx-conf
          configMap:
            name: nginx-conf
```








### 持续跟新中..........